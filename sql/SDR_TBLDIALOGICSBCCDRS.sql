DROP TABLE SDR_TBLDIALOGICSBCCDRS CASCADE CONSTRAINTS;
/
CREATE TABLE SDR_TBLDIALOGICSBCCDRS
(
	DSBC_RECORDID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  -- AUTO-INCREMENTED ID
	DSBC_ACCOUNTINGTIMESTAMP 			VARCHAR2(100),               	-- STRING FOR TIMESTAMPS
	DSBC_SDRSESSIONNUMBER 				NUMBER,                         -- FOR SESSION NUMBERS (INTEGER)
	DSBC_ACCOUNTINGSESSIONDURATION 		NUMBER,               		 	-- FOR DURATION IN SECONDS (INTEGER)
	DSBC_SDRSESSIONSTATUS 				NUMBER,                         -- FOR STATUS (INTEGER)
	DSBC_INGRESSSIGREMOTEADDRESS 		VARCHAR2(200),          		-- STRING FOR IP ADDRESS
	DSBC_INGRESSSIGREMOTEPORT 			NUMBER,          				-- FOR IP PORT (INTEGER)
	DSBC_EGRESSQ850CAUSECODEVALUE 		NUMBER,                			-- INTEGER FOR CAUSE CODES
	DSBC_INGRESSPEER 					VARCHAR2(200),                  -- STRING FOR PEER
	DSBC_INGRESSSIPCALLID 				VARCHAR2(200),                 	-- STRING FOR SIP CALL ID
	DSBC_INGRESSTIMESTAMPINVITE 		VARCHAR2(200),            		-- STRING FOR INVITE TIMESTAMP
	DSBC_INGRESSTIMESTAMP18X 			VARCHAR2(200),               	-- STRING FOR 18X TIMESTAMP
	DSBC_EGRESSPEER 					VARCHAR2(200),                  -- STRING FOR EGRESS PEER
	DSBC_EGRESSSIPCALLID 				VARCHAR2(200),                  -- STRING FOR SIP CALL ID
	DSBC_ORIGCALLINGPARTYUSER 			VARCHAR2(200),             		-- STRING FOR CALLING PARTY USER
	DSBC_ORIGCALLEDPARTYUSER 			VARCHAR2(200),                	-- STRING FOR CALLED PARTY USER
	NE_ELEMENTID                    	NUMBER,							-- INTEGER FOR NETWORK ELEMENT ID
	FILEID                       	NUMBER,							-- INTEGER FOR FILE ID
	PROCESSID                  	NUMBER,							-- INTEGER FOR PROCESS ID
	CHARGEID                   	NUMBER,							-- INTEGER FOR CHARGING ID
	INCOMINGNODEID             	NUMBER,							-- INTEGER FOR INCOMING NODE ID
	OUTGOINGNODEID             	NUMBER,							-- INTEGER FOR OUTGOING NODE ID
	CDR_ACTUAL_TIME            	VARCHAR2(100),					-- STRING FORFOR ACTUAL TIME
	GMTTIMEZONE                	NUMBER(4,2),					-- FLOAT FOR GMT TIME ZONE 5 FOR PAKISTAN
	RAW_JSON						CLOB					-- STRING FOR RAW CDR JSON OBJECT
)
/
CREATE OR REPLACE TRIGGER TRG_SDR_TBLDIALOGICSBCCDRS
AFTER INSERT OR UPDATE
ON SDR_TBLDIALOGICSBCCDRS REFERENCING NEW AS NEW OLD AS OLD
FOR EACH ROW
DECLARE
    SEQUENCE_NOT_CHANGE EXCEPTION;
BEGIN

IF INSERTING THEN
  
     INSERT INTO sdr_tblicpmissedcdrs
                  (icpmc_rawcdrid, icpmc_eventtime, icpmc_callednumber,
                   icpmc_callingnumber, icpmc_callduration,
                   ICPMC_ICPARSECODE, MCRT_TYPEID, NE_ELEMENTID,
                   icpmc_ogparsecode, icpmc_icerrorcode, icpmc_ogerrorcode, ICPMC_TRAFFICTYPE
                  )
               VALUES (:NEW.DSBC_RECORDID, TO_DATE(:NEW.DSBC_ACCOUNTINGTIMESTAMP,'YYYY-MM-DD+HH24:MI:SS'),
                         :NEW.DSBC_ORIGCALLEDPARTYUSER, :NEW.DSBC_ORIGCALLINGPARTYUSER,
                         :NEW.DSBC_ACCOUNTINGSESSIONDURATION, 0, 0, :NEW.NE_ELEMENTID, 0, 0,0,0
                  );

END IF;

EXCEPTION
    WHEN SEQUENCE_NOT_CHANGE THEN
       RAISE_APPLICATION_ERROR(-20000, 'Sequence value cannot be changed.');
END;
/
SHOW ERRORS;
/
/
DROP TABLE SDR_TBLICPCDRS;
/
CREATE TABLE SDR_TBLICPCDRS
(
  ICPR_RECORDID             NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ICPR_RAWCDRID             NUMBER(19)          NOT NULL,
  ICPR_EVENTTIME            DATE                NOT NULL,
  ICPR_USERNAME             VARCHAR2(64 BYTE)   NOT NULL,
  ICPR_CALLDURATION         NUMBER(19)          NOT NULL,
  ICPR_DISCONNECTCAUSE      VARCHAR2(25 BYTE)   NOT NULL,
  ICPR_CALLTYPE             NUMBER(3),
  ICPR_CALLID               VARCHAR2(100 BYTE)  NOT NULL,
  ICPR_CALLSTATE            NUMBER(3),
  NE_ELEMENTID              NUMBER(3)           NOT NULL,
  ICPR_IPADDRESS            VARCHAR2(20 BYTE),
  ICPR_CALLINGNUMBER        VARCHAR2(75 BYTE)   NOT NULL,
  ICPR_CALLEDNUMBER         VARCHAR2(75 BYTE)   NOT NULL,
  ICPR_ICCARRIERID          VARCHAR2(32 BYTE),
  ICPR_OGCARRIERID          VARCHAR2(32 BYTE),
  ICPR_INGRESSPAYTYPE       NUMBER(1),
  ICPR_INGRESSDESTID        NUMBER(10)          NOT NULL,
  ICPR_INGRESSBILLDURATION  NUMBER(19)          NOT NULL,
  ICPR_INGRESSAMOUNT        NUMBER(18,12)       NOT NULL,
  ICPR_EGRESSPAYTYPE        NUMBER(1),
  ICPR_EGRESSDESTID         NUMBER(10)          NOT NULL,
  ICPR_EGRESSBILLDURATION   NUMBER(19),
  ICPR_EGRESSAMOUNT         NUMBER(18,12),
  ICPR_INGRESSPARTNERID     NUMBER(10),
  ICPR_EGRESSPARTNERID      NUMBER(10),
  SP_PRODUCTID              NUMBER(10),
  ICPR_TRAFFICTYPE          NUMBER(2),
  ICPR_INGRESSNODEIDENID    NUMBER(10),
  ICPR_EGRESSNODEIDENID     NUMBER(10),
  CO_COUNTRYPREFIX          NUMBER(10),
  ICPR_INGRESSRATEPERMIN    NUMBER(18,12),
  ICPR_EGRESSRATEPERMIN     NUMBER(18,12),
  PG_PACKAGEID              NUMBER(10),
  ICPR_ERRORCODE            NUMBER(3),
  ICPR_FAILCODE             NUMBER(3),
  ICPR_PAIRCALLSTATE        NUMBER(1),
  NE_LOCATIONID             NUMBER(6)           NOT NULL,
  ICPR_APCCHARGES           NUMBER(18,5)        NOT NULL,
  ICPR_USFCHARGES           NUMBER(18,5)        NOT NULL,
  CT_INCHARGINGTYPEID       NUMBER(6)           NOT NULL,
  CT_EGCHARGINGTYPEID       NUMBER(6)           NOT NULL,
  EX_SRCEXCHANGEID          NUMBER(6)           NOT NULL,
  EX_DESEXCHANGEID          NUMBER(6)           NOT NULL,
  ICPR_INDESTPREFIX         VARCHAR2(64 BYTE)   NOT NULL,
  ICPR_EGDESTPREFIX         VARCHAR2(64 BYTE)   NOT NULL,
  DPT_INPREFIXTYPEID        NUMBER(6)           NOT NULL,
  DPT_EGPREFIXTYPEID        NUMBER(3)           NOT NULL,
  IBP_INBILLINGPERIODID     NUMBER(10)          NOT NULL,
  IBP_OGBILLINGPERIODID     NUMBER(10),
  IBP_EGBILLINGPERIODID     NUMBER(10)          NOT NULL,
  ICPR_INSUBINV_CRNOTEID    NUMBER(10),
  ICPR_EGSUBINV_CRNOTEID    NUMBER(10),
  IT_TRANSITID              NUMBER(5),
  DZD_DISTSLABID            NUMBER(6),
  TSD_SLABDEFID             NUMBER(6),
  ICPR_EVENTSTARTTIME       DATE,
  ICPR_INCOMINGCODEC        VARCHAR2(64 BYTE),
  ICPR_OUTGOINGCODEC        VARCHAR2(64 BYTE),
  ICPR_INPAYTOCARRIER       NUMBER(1)           NOT NULL,
  ICPR_EGPAYTOCARRIER       NUMBER(1)           NOT NULL,
  PS_INSUBINVOICEID         NUMBER(10),
  PS_EGSUBINVOICEID         NUMBER(10),
  RP_ROUTEPREFIXID          NUMBER(5),
  ICPR_INTECHPREFIX         VARCHAR2(20 BYTE),
  ICPR_TOTALAMOUNT          NUMBER(18,5),
  ICPR_BTRAMOUNT            NUMBER(18,5),
  ICPR_INGCURRENCYID        NUMBER(5),
  ICPR_EGCURRENCYID         NUMBER(5),
  ICPR_INGCURRENCYRATE      NUMBER(8,4),
  ICPR_EGCURRENCYRATE       NUMBER(8,4)
)
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;
/
/
/
/
DROP TABLE SDR_TBLICPZERODURCDRS;
/
CREATE TABLE SDR_TBLICPZERODURCDRS
(
  ICPR_RECORDID          NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ICPR_RAWCDRID          NUMBER(19),
  ICPR_EVENTTIME         DATE                   DEFAULT (SYSDATE)             NOT NULL,
  ICPR_DISCONNECTCAUSE   VARCHAR2(25 BYTE)      DEFAULT ('00')                NOT NULL,
  NE_ELEMENTID           NUMBER(3)              DEFAULT 0                     NOT NULL,
  ICPR_CALLINGNUMBER     VARCHAR2(50 BYTE)      DEFAULT ('00')                NOT NULL,
  ICPR_CALLEDNUMBER      VARCHAR2(50 BYTE)      DEFAULT ('00')                NOT NULL,
  ICPR_ICCARRIERID       VARCHAR2(32 BYTE)      DEFAULT ('00')                NOT NULL,
  ICPR_OGCARRIERID       VARCHAR2(32 BYTE)      DEFAULT ('00')                NOT NULL,
  ICPR_INGRESSDESTID     NUMBER(10)             DEFAULT 0                     NOT NULL,
  ICPR_EGRESSDESTID      NUMBER(10)             DEFAULT 0                     NOT NULL,
  ICPR_INGRESSPARTNERID  NUMBER(10)             DEFAULT 0                     NOT NULL,
  ICPR_EGRESSPARTNERID   NUMBER(10)             DEFAULT 0                     NOT NULL,
  ICPR_TRAFFICTYPE       NUMBER(2)              DEFAULT 0                     NOT NULL,
  ICPR_INGRESSNODEID     NUMBER(10)             DEFAULT 0                     NOT NULL,
  ICPR_EGRESSNODEID      NUMBER(10)             DEFAULT 0                     NOT NULL,
  CO_COUNTRYPREFIX       NUMBER(10)             DEFAULT 0                     NOT NULL,
  ICPR_INDESTPREFIX      VARCHAR2(64 BYTE)      DEFAULT (0),
  ICPR_EGDESTPREFIX      VARCHAR2(64 BYTE)      DEFAULT (0),
  RP_ROUTEPREFIXID		 NUMBER(10)             DEFAULT 0                     NOT NULL
)
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;
/
/
-- Drop the table if it exists, along with constraints
DROP TABLE SDR_TBLICPMISSEDCDRS CASCADE CONSTRAINTS;

-- Create the table with an auto-incrementing ICPMC_CDRID
CREATE TABLE SDR_TBLICPMISSEDCDRS
(
  ICPMC_CDRID          NUMBER(10) GENERATED ALWAYS AS IDENTITY NOT NULL,
  ICPMC_RAWCDRID       NUMBER(10)               NOT NULL,
  ICPMC_EVENTTIME      DATE,
  ICPMC_CALLEDNUMBER   VARCHAR2(225 BYTE),
  ICPMC_CALLINGNUMBER  VARCHAR2(150 BYTE),
  ICPMC_CALLDURATION   NUMBER(10)               NOT NULL,
  ICPMC_ICPARSECODE    NUMBER(2)                NOT NULL,
  MCRT_TYPEID          NUMBER(2)                NOT NULL,
  NE_ELEMENTID         NUMBER(3)                NOT NULL,
  ICPMC_OGPARSECODE    NUMBER(2)                NOT NULL,
  ICPMC_ICERRORCODE    NUMBER(2)                NOT NULL,
  ICPMC_OGERRORCODE    NUMBER(2)                NOT NULL,
  ICPMC_TRAFFICTYPE    NUMBER(2)                NOT NULL
)
TABLESPACE SYSTEM
PCTUSED    40
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;
/
/
-- Drop the table if it exists, along with constraints
DROP TABLE TMR_TBLFILENAMES CASCADE CONSTRAINTS;

-- Create the table with an auto-incrementing FN_FILEID
CREATE TABLE TMR_TBLFILENAMES
(
  FN_FILEID            NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  FN_FILENAME          VARCHAR2(100 BYTE)       NOT NULL,
  FN_PROCESSINGDATE    DATE,
  FN_REPROCESSINGDATE  DATE,
  FS_FILESTATEID       NUMBER(1)                DEFAULT (0)                   NOT NULL,
  MPH_PROCID           NUMBER(10)               DEFAULT (0)                   NOT NULL,
  FN_TOTALRECORDS      NUMBER(8)                DEFAULT (0)                   NOT NULL,
  FN_PROCESSEDRECORDS  NUMBER(8)                DEFAULT (0)                   NOT NULL,
  NE_ELEMENTID         NUMBER(4)                DEFAULT (0)                   NOT NULL,
  FN_DUPRECORDS        NUMBER(5)                DEFAULT (0)                   NOT NULL,
  FN_INSERTDATE        DATE,
  FN_FILESIZE          NUMBER(10)               DEFAULT (0)                   NOT NULL,
  CPH_PROCID           NUMBER(10)               DEFAULT (0)                   NOT NULL,
  FN_ISSECONDARY       NUMBER(1)                DEFAULT (0)                   NOT NULL,
  FN_BILLABLERECORDS   NUMBER(10)
)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;
/
/
/
-- Drop the table if it exists
DROP TABLE SC_TBLAPPPROCHISTORY CASCADE CONSTRAINTS;

-- Create the table with APH_PROCID as an auto-increment (IDENTITY) column
CREATE TABLE SC_TBLAPPPROCHISTORY
(
  APH_PROCID            NUMBER(10) GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  APH_PROCNAME          VARCHAR2(50 BYTE),
  AS_SERVERID           NUMBER(4)               DEFAULT (0),
  APH_PROCDATE          DATE                    NOT NULL,
  APH_ISSUCCESS         NUMBER(1)               DEFAULT (0)                   NOT NULL,
  APH_PROCESSEDRECORDS  NUMBER(5)               DEFAULT (0)                   NOT NULL,
  APH_TIMECONSUMEDMS    NUMBER(10)              DEFAULT (0)                   NOT NULL,
  APH_ERRORRECORDS      NUMBER(5)               DEFAULT (0)                   NOT NULL
)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          46M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;
/
/
/
